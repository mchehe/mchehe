<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>电影</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/all.css">
	<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/dot/2.0.0-beta.0/doT.min.js"></script>
</head>
<body>
	<header>
		<div class="nav-button" data-fancynav-animation="slide-along"><i class="icon-list-bullet"></i></div>
		<nav id="nav-box"></nav>
		<form class="search" method="get"><input type="search" name="wd"/><i class="icon-search"></i></form>
	</header>
	<div id="interpolation" class="vod-list"></div>
	<div class="clear"></div>
	<div class="page">
	<div class="page-next"><a href="javascript:void(0)">加载更多</a></div>
	</div>
	<div class="clear"></div>
	<script id="nav-boxtmpl" type="text/x-dot-template">
	<ul>
	{{ for(var key in it) { }}
	<li class="nav1"><a href="javascript:void(0)" onClick="classData('{{= it[key]["type_id"] }}')">{{= it[key]["type_name"] }}</a></li>
	{{ } }}
	</ul>
	</script>
	<script id="interpolationtmpl" type="text/x-dot-template">
	<ul>
	{{ for(var key in it) { }}
	<li class="list"><div><a href="play.html?id={{= it[key]["vod_id"] }}"><img src="{{= it[key]["vod_pic"] }}"><p class="name">{{= it[key]["vod_name"] }}</p></a></div></li>
	{{ } }}
	</ul>
	</script>
	<script type="text/javascript">
		var pg=1;
		if (getString(wd)!=null){
		  var wd=getString(wd);
			alert(wd);
		}else{
			var wd="";
			alert("1"+wd);
		}
		var t="";
		getData(pg,t,wd);
		function getData(pg,t,wd){
			$.ajax({
		        url:"https://dy.26an.cn/api.php/provide/vod/?ac=detail&pg="+pg+"&t="+t+"&wd="+wd,
		        type:"get",
		        dataType:"json",
		        success: function(data) {
				var classText = doT.template($("#nav-boxtmpl").text());
				$("#nav-box").append(classText(data.class));
		        	var list = data.list;
		        	if (list.length>0){
			            var evalText = doT.template($("#interpolationtmpl").text());
						$("#interpolation").append(evalText(list)); 
					} else{
						$(".page-next").text("没有更多");
					}
		        },
		        error: function(XMLHttpRequest, textStatus, errorThrown) {
		            alert(XMLHttpRequest.status);
		            alert(XMLHttpRequest.readyState);
		            alert(textStatus);
		        },
		    });
		}
		$(".page-next").click(function(){
		  pg++;
		  getData(pg,t,wd);
		});
		function classData(t){
		   getData(pg,t,wd);
		};
		$(".nav-button").click(function(){
		  $("nav").slideToggle();
		});
		function getString(name) {
				    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
				    var r = window.location.search.substr(1).match(reg);
				    if (r != null) return unescape(r[2]); return null;
			}
	</script>
</body>
</html>
